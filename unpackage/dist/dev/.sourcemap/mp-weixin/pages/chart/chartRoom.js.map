{"version":3,"sources":["uni-app:///main.js","webpack:///D:/myself/work/student_video/pages/chart/chartRoom.vue?c1db","webpack:///D:/myself/work/student_video/pages/chart/chartRoom.vue?a4c8","webpack:///D:/myself/work/student_video/pages/chart/chartRoom.vue?653c","webpack:///D:/myself/work/student_video/pages/chart/chartRoom.vue?7f77","uni-app:///pages/chart/chartRoom.vue","webpack:///D:/myself/work/student_video/pages/chart/chartRoom.vue?be34"],"names":["createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped"],"mappings":";;;;wEAAA,qBACA,sBACA,8C,mDACAA,EAAWC,a;;;;2DCHX,qRACIC,EADJ,kKASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,4BACZ,aAAAF,E;;;;2GCvBf,4lC;;;;2GCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G;;;;2DCRvB,+tBAAwqB,eAAG,G;;;;0ICmE3qB,kEACA,4B,yDAGA,CACA,mBACA,KAFA,WAGA,OAEA,gBAKA,YACA,YAEA,gBAEA,WACA,aACA,cACA,kBACA,SAEA,UACA,iBACA,SACA,MACA,OACA,SAGA,eAEA,cAQA,UACA,OACA,OACA,SAGA,UACA,YACA,SACA,aAGA,cAGA,OAtDA,SAsDA,GACA,sBAGA,yBACA,gBAGA,gDAOA,cArEA,WAsEA,kCACA,iBAEA,OAzEA,WA2EA,qBACA,WAGA,QA/EA,WAgFA,WAEA,iBACA,QADA,SACA,GACA,6BAEA,mDACA,EACA,gCAEA,yBACA,gCAEA,wCACA,oDAEA,WAIA,SAEA,SAFA,WAEA,WACA,iCACA,gBAIA,iBACA,eACA,wBAGA,2BACA,kBACA,kCAGA,4BACA,kBACA,kCAGA,4BACA,kBACA,kCAGA,+BACA,yBAEA,YAWA,0CACA,sCACA,6BACA,8CACA,kBACA,UACA,cAEA,0CACA,iCACA,+BACA,gCACA,kCACA,iCAxBA,CAEA,sCAGA,6BACA,8CACA,kBACA,SAoBA,+BAGA,wCACA,qBACA,YACA,qBACA,gBACA,uBAGA,SAIA,aA1EA,WA0EA,WAEA,iCAEA,4CACA,kBACA,kCAEA,YAEA,wBAEA,sBACA,WACA,+BAGA,uBACA,wBAGA,aAEA,4CAEA,oCACA,iBAEA,kBACA,YACA,wBAIA,UA5GA,WA4GA,WACA,kBAEA,2BACA,gBAEA,kCACA,MAEA,oDACA,EACA,gCACA,iCACA,oCAEA,YAKA,KAhIA,WAgIA,WAGA,GAFA,iCAEA,mBAEA,sBAEA,mBAEA,2CAEA,gBAEA,iBAKA,+BACA,qBACA,OACA,mBACA,kBACA,yCAEA,gBACA,gEAKA,uDAIA,KAnKA,WAoKA,oBAGA,MAvKA,SAuKA,GACA,mCAEA,6BAGA,QA7KA,WA8KA,uBACA,8BAGA,QAlLA,WAmLA,yBACA,8BAIA,QAxLA,SAwLA,GACA,sCAEA,gDACA,gDAEA,IA9LA,SA8LA,GACA,iCAMA,OArMA,SAqMA,GACA,sD;;;;2DCjXA,ywCAA2tC,eAAG,G","file":"pages/chart/chartRoom.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/chart/chartRoom.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chartRoom.vue?vue&type=template&id=0f36017f&\"\nvar renderjs\nimport script from \"./chartRoom.vue?vue&type=script&lang=js&\"\nexport * from \"./chartRoom.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chartRoom.vue?vue&type=style&index=0&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chart/chartRoom.vue\"\nexport default component.exports","export * from \"-!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chartRoom.vue?vue&type=template&id=0f36017f&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chartRoom.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chartRoom.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"chartRoom\">\r\n\t\t<!-- 用户信息交流区域 采用scrollView区域渲染 -->\r\n\t\t<!-- <scroll-view scroll-y=\"true\" \r\n\t\t\t:style=scrollviewHigh\r\n\t\t\tclass=\"scroll\"\r\n\t\t> -->\r\n\t\t<!-- bottom=\"50%\" -->\r\n\t\t<mescroll-body class=\"scroll\" ref=\"mescrollRef\" @init=\"mescrollInit\" :down=\"downOption\" @down=\"downCallback\" :up=\"upOption\" bottom=\"50%\">\r\n\t\t\t<view v-if=\"isEnd\" class=\"msg-end\">没有更多消息了</view>\r\n\t\t\t<view class=\"chartBox\">\r\n\t\t\t\t<!-- 接收方 在左侧显示 -->\r\n\t\t\t\t<view class=\"chart_left\" v-for=\"(item, index) in chartLeft\" :key=\"index\">\r\n\t\t\t\t\t<!-- 接收方头像 -->\r\n\t\t\t\t\t<view class=\"left_userimg\"><image src=\"\" mode=\"\"></image></view>\r\n\t\t\t\t\t<!-- 接收消息显示 -->\r\n\t\t\t\t\t<view class=\"left_msg\">{{ item }}</view>\r\n\t\t\t\t</view>\r\n\r\n\t\t\t\t<!-- 发送方 在右侧显示 -->\r\n\t\t\t\t<view class=\"chart_right\" v-for=\"(item, index) in chartRight\" :key=\"item.id\">\r\n\t\t\t\t\t<!-- 发送消息显示 -->\r\n\t\t\t\t\t<view class=\"right_msg\">{{ item.title }}</view>\r\n\t\t\t\t\t<!-- 发送方头像 -->\r\n\t\t\t\t\t<view class=\"right_userimg\"><image :src=\"rightUserImg\" mode=\"\"></image></view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</mescroll-body>\r\n\t\t<!-- </scroll-view> -->\r\n\r\n\t\t<!-- 输入框 -->\r\n\t\t<view class=\"input_box height\" :style=\"inputBottom\">\r\n\t\t\t<!-- 输入框 -->\r\n\t\t\t<input\r\n\t\t\t\tclass=\"uni-input\"\r\n\t\t\t\tcursor-spacing=\"10\"\r\n\t\t\t\ttype=\"text\"\r\n\t\t\t\t:value=\"sendVal\"\r\n\t\t\t\tplaceholder=\"发消息...\"\r\n\t\t\t\t@input=\"input\"\r\n\t\t\t\t@keyboardheightchange=\"keyWord\"\r\n\t\t\t\t@confirm=\"end\"\r\n\t\t\t\t@blur=\"blur\"\r\n\t\t\t\t:adjust-position=\"false\"\r\n\t\t\t\t:hold-keyboard=\"false\"\r\n\t\t\t/>\r\n\t\t\t<!-- 表情选择框 -->\r\n\t\t\t<view class=\"expression border\" @click=\"showExp\"><image src=\"../../static/chartExpress.png\" mode=\"aspectFit\"></image></view>\r\n\t\t\t<!-- 选择图片框 -->\r\n\t\t\t<view v-if=\"sendVal.length === 0\" class=\"addImg border\" @click=\"showImg\"><image src=\"../../static/chartAdd.png\" mode=\"aspectFit\"></image></view>\r\n\t\t\t<!-- 发送框 当输入框中有值了 图片按钮消失 显示发送按钮 -->\r\n\t\t\t<view v-else class=\"send\" @click=\"send\">发送</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 显示选择图片 和 表情  -->\r\n\t\t<!-- \t<view class=\"choose\">\r\n\t\t\t图片和表情\r\n\t\t</view> -->\r\n\r\n\t\t<!-- 弹出框 用户点击添加按钮 可以从相册选取图片 -->\r\n\t\t<!-- <uni-popup :selfMask=\"selfMask\" ref=\"popupChart\" type=\"share\" @change=\"change\">\r\n\t\t\t<uni-popup-chart title=\"评论\" @select=\"select\"></uni-popup-chart>\r\n\t\t</uni-popup> -->\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport MescrollMixin from '@/components/mescroll-uni/mescroll-mixins.js';\r\nimport { apiMsgList } from '@/API/mock.js';\r\n// 导入 发送图片的弹框\r\n// import uniPopupChart from '../../components/uni-popup/uni-popup-chart.vue'\r\nexport default {\r\n\tmixins: [MescrollMixin],\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\t// 监控 websocket 的参数\r\n\t\t\tisSocketOpen:'',\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// 判断是否显示表情和发送本机图片\r\n\t\t\tshow_exp: false,\r\n\t\t\tshow_img: false,\r\n\t\t\t// 用户的头像\r\n\t\t\trightUserImg: '',\r\n\r\n\t\t\tsendVal: '',\r\n\t\t\tchartLeft: [],\r\n\t\t\tchartRight: [],\r\n\t\t\tscrollviewHigh: '', //滚动区域的高度\r\n\t\t\theight: 0,\r\n\t\t\t// 自定义遮罩层\r\n\t\t\tselfMask: {\r\n\t\t\t\tposition: 'fixed',\r\n\t\t\t\tbottom: 0,\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tleft: 0,\r\n\t\t\t\tright: 0\r\n\t\t\t},\r\n\t\t\t// 控制input框的高度\r\n\t\t\tinputBottom: '',\r\n\t\t\t// 控制自定义表情图片的高度\r\n\t\t\tshowHeight: '',\r\n\r\n\t\t\t// 滚动组件\r\n\t\t\t// downOption: {\r\n\t\t\t// \tautoShowLoading: true, // 显示下拉刷新的进度条\r\n\t\t\t// \tminAngle: 70, // 增大触发下拉刷新的角度\r\n\t\t\t// \ttextColor: '#000000' // 下拉刷新的文本颜色\r\n\t\t\t// },\r\n\t\t\tupOption: {\r\n\t\t\t\tuse: false, // 禁止上拉\r\n\t\t\t\ttoTop: {\r\n\t\t\t\t\tsrc: '' // 不显示回到顶部按钮\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tpageNum: 1, // 页码\r\n\t\t\tpageSize: 10, // 页长\r\n\t\t\tisEnd: false, // 是否无消息\r\n\t\t\tmsgList: []\r\n\t\t};\r\n\t},\r\n\tcomponents: {\r\n\t\t// uniPopupChart\r\n\t},\r\n\tonLoad(option) {\r\n\t\tconsole.log('进入聊天界面');\r\n\t\t// this.$refs.popupChart.open()\r\n\t\t// 聊天室，导航栏改变成 聊天对象的名称\r\n\t\tuni.setNavigationBarTitle({\r\n\t\t\ttitle: option.uname\r\n\t\t});\r\n\t\t// 获取发送方的头像\r\n\t\tthis.rightUserImg = uni.getStorageSync('user_img');\r\n\r\n\t\t// 判断两者之间是否进行了 websocket 链接\r\n\t\t// this.chatInit()  //socket相关操作\r\n\t\t\r\n\t\t\r\n\t},\r\n\tbeforeDestroy() {\r\n\t\tclearInterval(this.pingpangTimes)  //清除socket心跳定时器\r\n\t\tuni.closeSocket()  //关闭socket\r\n\t},\r\n\tonShow() {\r\n\t\t// 当用户进入到聊天界面之后，将tabbar 的角标去掉\r\n\t\tuni.removeTabBarBadge({\r\n\t\t\tindex: 3\r\n\t\t});\r\n\t},\r\n\tonReady() {\r\n\t\tlet _this = this;\r\n\t\t// 动态设计消息滚动区域的高度\r\n\t\tuni.getSystemInfo({\r\n\t\t\tsuccess(res) {\r\n\t\t\t\t_this.phoneHeight = res.windowHeight; //获取用户设备的高度\r\n\t\t\t\t// 计算组件的高度\r\n\t\t\t\tlet view = uni.createSelectorQuery().selectAll('.height');\r\n\t\t\t\tview\r\n\t\t\t\t\t.boundingClientRect(data => {\r\n\t\t\t\t\t\t// 计算上方各元素的高度总和\r\n\t\t\t\t\t\tdata.forEach((item, index) => {\r\n\t\t\t\t\t\t\t_this.height += parseInt(item.height);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t_this.scrollviewHigh = _this.phoneHeight - _this.height;\r\n\t\t\t\t\t\t_this.scrollviewHigh = 'height:' + _this.scrollviewHigh + 'px';\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.exec();\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tmethods: {\r\n\t\t// 建立 websocket 连接 进行交流沟通\r\n\t\tchatInit() {\r\n\t\t\tthis.api._get('',{},(res)=>{\r\n\t\t\t\tuni.closeSocket(); //创建新的socket连接前确保旧的已关闭\r\n\t\t\t\t// 在 res 中 返回创建的 wss 连接地址\r\n\t\t\t\t// let socketlink = res.data.msg\r\n\t\t\t\t//创建一个socket连接\r\n\t\t\t\tuni.connectSocket({\r\n\t\t\t\t\turl: socketlink,\r\n\t\t\t\t\tsuccess: res => {}\r\n\t\t\t\t});\r\n\t\t\t\t//监听socket打开\r\n\t\t\t\tuni.onSocketOpen(() => {\r\n\t\t\t\t\tthis.isSocketOpen = true;\r\n\t\t\t\t\tconsole.log('WebSocket连接已打开！');\r\n\t\t\t\t});\r\n\t\t\t\t//监听socket关闭\r\n\t\t\t\tuni.onSocketClose(() => {\r\n\t\t\t\t\tthis.isSocketOpen = false;\r\n\t\t\t\t\tconsole.log('WebSocket连接已关闭！');\r\n\t\t\t\t});\r\n\t\t\t\t//监听socket错误\r\n\t\t\t\tuni.onSocketError(() => {\r\n\t\t\t\t\tthis.isSocketOpen = false;\r\n\t\t\t\t\tconsole.log('WebSocket连接打开失败');\r\n\t\t\t\t});\r\n\t\t\t\t//监听socket消息\r\n\t\t\t\tuni.onSocketMessage(res => {\r\n\t\t\t\t\tlet infos = JSON.parse(res.data); //socket信息是字符串，需要先转成json形式再去解析内容\r\n\t\t\t\t\t//后端规定cadmin为0--用户发言，为1--管理员发言，为2--系统提示，为3--需登录，为5--心跳信息\r\n\t\t\t\t\tif (!infos.cadmin) {\r\n\t\t\t\t\t\t//infos.cadmin不存在说明返回的是数组，说明是第一次获取的之前的所有聊天记录\r\n\t\t\t\t\t\tthis.commentList = this.commentList.concat(infos);\r\n\t\t\t\t\t\t//设置定时器，到时间后滚动到最底部。使用scroll-view组件的scroll-top属性。\r\n\t\t\t\t\t\t// 只要scroll-top的值大于滚动区域的最大高度即可实现滚动到最底部\r\n\t\t\t\t\t\tlet scrolltimes = setTimeout(() => {\r\n\t\t\t\t\t\t\tthis.commentScrollCount = this.commentList.length * 200;\r\n\t\t\t\t\t\t\tclearTimeout(scrolltimes);\r\n\t\t\t\t\t\t}, 600);\r\n\t\t\t\t\r\n\t\t\t\t\t\t//后续每次更新一条有效的新聊天（心跳信息pong不是有效聊天），就会触发这个\r\n\t\t\t\t\t} else if (infos.cadmin == 0 || infos.cadmin == 1 || infos.cadmin == 2) {\r\n\t\t\t\t\t\tthis.commentList = this.commentList.concat(infos);\r\n\t\t\t\t\t\tlet scrolltimes = setTimeout(() => {\r\n\t\t\t\t\t\t\tthis.commentScrollCount = this.commentList.length * 200;\r\n\t\t\t\t\t\t\tclearTimeout(scrolltimes);\r\n\t\t\t\t\t\t}, 150);\r\n\t\t\t\t\t} else if (infos.cadmin == 3) {\r\n\t\t\t\t\t\t//未登录\r\n\t\t\t\t\t\tthis.loginPopRemind = '您尚未登录或您的登录已过期，请重新登录后发言';\r\n\t\t\t\t\t\tuni.removeStorageSync('kusername');\r\n\t\t\t\t\t\tuni.removeStorageSync('kuserid');\r\n\t\t\t\t\t\tuni.removeStorageSync('kuserimg');\r\n\t\t\t\t\t\tuni.removeStorageSync('kusertoken');\r\n\t\t\t\t\t\tthis.$refs.noLoginPopup.open();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t//先确保清除了之前的心跳定时器\r\n\t\t\t\tclearInterval(this.pingpangTimes);\r\n\t\t\t\t//每过一段时间发送一次心跳，发送Ping,服务器会反馈pong，\r\n\t\t\t\t// 这样操作以保持socket一直是连接状态，防止断开连接，心跳停止\r\n\t\t\t\tthis.pingpangTimes = setInterval(() => {\r\n\t\t\t\t\tuni.sendSocketMessage({\r\n\t\t\t\t\t\tdata: 'ping',\r\n\t\t\t\t\t\tsuccess: () => {},\r\n\t\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\t\tthis.isSocketOpen = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}, 60000);\r\n\t\t\t})\r\n\t\t},\r\n\t\t/*下拉刷新的回调 */\r\n\t\tdownCallback() {\r\n\t\t\t// 在这里发起网络请求，用于获取聊天记录\r\n\t\t\tconsole.log('进行下拉请求，请求原先的聊天记录');\r\n\t\t\t//联网加载数据\r\n\t\t\tapiMsgList(this.pageNum, this.pageSize)\r\n\t\t\t\t.then(data => {\r\n\t\t\t\t\tconsole.log('下拉请求的数据 data ==》', data);\r\n\t\t\t\t\t// 需自行维护页码\r\n\t\t\t\t\tthis.pageNum++;\r\n\t\t\t\t\t// 先隐藏下拉刷新的状态\r\n\t\t\t\t\tthis.mescroll.endSuccess();\r\n\t\t\t\t\t// 不满一页,说明已经无更多消息 (建议根据您实际接口返回的总页码数,总消息量,是否有消息的字段来判断)\r\n\t\t\t\t\tif (data.length < this.pageSize) {\r\n\t\t\t\t\t\tthis.isEnd = true; // 标记已无更多消息\r\n\t\t\t\t\t\tthis.mescroll.lockDownScroll(true); // 锁定下拉\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 生成VIEW_ID,大写,避免污染源数据\r\n\t\t\t\t\tdata.forEach(val => {\r\n\t\t\t\t\t\tval.VIEW_ID = 'msg' + val.id; // 不以数字开头\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// 获取当前最顶部的VIEW_ID (注意是写在data.concat前面)\r\n\t\t\t\t\tlet topMsg = this.msgList[0];\r\n\t\t\t\t\t//设置列表数据\r\n\t\t\t\t\tconsole.log('下拉获取数据 data', data, 'this.msgList');\r\n\t\t\t\t\t// 判断是那个用户的消息，将其放入相应的列表\r\n\t\t\t\t\tthis.chartRight = data.concat(this.chartRight); // 注意不是this.msgList.concat\r\n\t\t\t\t\tthis.msgscroll();\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthis.pageNum--; // 联网失败,必须回减页码\r\n\t\t\t\t\tthis.mescroll.endErr(); // 隐藏下拉刷新的状态\r\n\t\t\t\t});\r\n\t\t},\r\n\t\t// 控制消息页面的滚动\r\n\t\tmsgscroll() {\r\n\t\t\tlet topMsg = this.msgList[0];\r\n\t\t\t// 控制聊天的消息界面的滚动\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tif (this.pageNum <= 2) {\r\n\t\t\t\t\t// 第一页直接滚动到底部 ( this.pageNum已在前面加1 )\r\n\t\t\t\t\tthis.mescroll.scrollTo(99999, 0);\r\n\t\t\t\t} else if (topMsg) {\r\n\t\t\t\t\t// 保持顶部消息的位置\r\n\t\t\t\t\tlet view = uni.createSelectorQuery().select('#' + topMsg.VIEW_ID);\r\n\t\t\t\t\tview\r\n\t\t\t\t\t\t.boundingClientRect(v => {\r\n\t\t\t\t\t\t\tconsole.log('节点离页面顶部的距离=' + v.top);\r\n\t\t\t\t\t\t\tthis.mescroll.scrollTo(v.top - 100, 0); // 减去上偏移量100\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.exec();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 当进行点击发送之后\r\n\t\tsend() {\r\n\t\t\tconsole.log('发送消息', this.sendVal);\r\n\t\t\t// 判断当前 websocket 连接是否正常\r\n\t\t\tif (this.isSocketOpen) {\r\n\t\t\t\t//socket连接正常\r\n\t\t\t\tthis.commentValue = val;\r\n\t\t\t\t// 用户发布的 聊天信息\r\n\t\t\t\tthis.inputBottom = 0;\r\n\t\t\t\t// 将发送方的消息储存到 chartRight\r\n\t\t\t\tthis.chartRight.push({ title: this.sendVal });\r\n\t\t\t\t// 然后清空输入框内容\r\n\t\t\t\tthis.sendVal = '';\r\n\t\t\t\t// 消息界面向上进行滚动\r\n\t\t\t\tthis.msgscroll();\r\n\t\t\t\t// \r\n\t\t\t\t// let theValue = {\r\n\t\t\t\t// \tccontent: this.commentValue\r\n\t\t\t\t// };\r\n\t\t\t\tlet transedValue = JSON.stringify(theValue); //后端规定的评论数据格式:json转字符串\r\n\t\t\t\tuni.sendSocketMessage({\r\n\t\t\t\t\tdata: transedValue,\r\n\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\tthis.commentValue = '';\r\n\t\t\t\t\t\tuni.showToast({ title: '发送成功', icon: 'none' });\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\tuni.showToast({ title: '发送失败，请稍后再试或重新进入此页面尝试', icon: 'none' });\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t//socket已断开\r\n\t\t\t\tuni.showToast({ title: '聊天断开啦，请重新进入此页面尝试 ~', icon: 'none' });\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 当输入框失去焦点之后\r\n\t\tblur() {\r\n\t\t\tthis.inputBottom = 0;\r\n\t\t},\r\n\t\t// 当用户进行输入\r\n\t\tinput(e) {\r\n\t\t\tconsole.log('用户输入', e.detail.value);\r\n\t\t\t// 储存用户输入值\r\n\t\t\tthis.sendVal = e.detail.value;\r\n\t\t},\r\n\t\t// 显示表情选择框\r\n\t\tshowExp() {\r\n\t\t\tconsole.log('显示表情小图案');\r\n\t\t\tthis.show_exp = !this.show_exp;\r\n\t\t},\r\n\t\t// 显示选择图片框\r\n\t\tshowImg() {\r\n\t\t\tconsole.log('显示 选择本机图片');\r\n\t\t\tthis.show_img = !this.show_img;\r\n\t\t\t// this.$refs.popupChart.open()\r\n\t\t},\r\n\t\t// 监控键盘高度的变化\r\n\t\tkeyWord(e) {\r\n\t\t\tconsole.log('键盘高度变化', e.detail.height);\r\n\t\t\t//设置键盘抬起的高度\r\n\t\t\tthis.inputBottom = 'bottom:' + e.detail.height + 'px';\r\n\t\t\tthis.showHeight = 'height:' + e.detail.height + 'px';\r\n\t\t},\r\n\t\tend(e) {\r\n\t\t\tconsole.log('点击完成时触发', e.detail);\r\n\t\t},\r\n\t\t/**\r\n\t\t * popup 状态发生变化触发\r\n\t\t * @param {Object} e\r\n\t\t */\r\n\t\tchange(e) {\r\n\t\t\tconsole.log('弹窗状态改变', 'popup ' + e.type + ' 状态', e.show);\r\n\t\t\t// console.log('popup ' + e.type + ' 状态', e.show)\r\n\r\n\t\t\t// let ctx = this.videoContextList[this.videoIndex]\r\n\r\n\t\t\t// // 当弹窗消失之后自动对视频进行播放\r\n\t\t\t// if(e.show){\r\n\t\t\t// \t// 当弹窗进行显示之后暂停当前视频\r\n\t\t\t// \tthis.isPlay = false\r\n\t\t\t// \tctx.pause();\r\n\t\t\t// }else{\r\n\t\t\t// \tthis.isPlay = true\r\n\t\t\t// \tctx.play();\r\n\t\t\t// }\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n.chartRoom {\r\n\t// background-color: #f6f6f6;\r\n\t// position: fixed;\r\n\t// top: 0;\r\n\t// left: 0;\r\n\t// right: 0;\r\n\t// bottom: 0;\r\n\t.scroll {\r\n\t\tbackground-color: red;\r\n\t\t.chartBox {\r\n\t\t\t// position: sticky;\r\n\t\t\t// top: 0;\r\n\t\t\t.chart_right {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\tpadding: 0 20rpx;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tmargin: 40rpx 0;\r\n\t\t\t\t.right_msg {\r\n\t\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\t\tbackground-color: #5d92e2;\r\n\t\t\t\t\tborder-radius: 40rpx;\r\n\t\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\t\tpadding: 10rpx 15rpx;\r\n\t\t\t\t}\r\n\t\t\t\t.right_userimg {\r\n\t\t\t\t\twidth: 80rpx;\r\n\t\t\t\t\theight: 80rpx;\r\n\t\t\t\t\tbackground-color: yellow;\r\n\t\t\t\t\tborder-radius: 50%;\r\n\t\t\t\t\toverflow: hidden;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t.chart_left {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\tpadding: 0 20rpx;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: flex-start;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tmargin: 40rpx 0;\r\n\t\t\t\t.left_msg {\r\n\t\t\t\t\tmargin-left: 20rpx;\r\n\t\t\t\t\tbackground-color: #5d92e2;\r\n\t\t\t\t\tborder-radius: 40rpx;\r\n\t\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\t\tpadding: 20rpx 15rpx;\r\n\t\t\t\t}\r\n\t\t\t\t.left_userimg {\r\n\t\t\t\t\twidth: 80rpx;\r\n\t\t\t\t\theight: 80rpx;\r\n\t\t\t\t\tbackground-color: yellow;\r\n\t\t\t\t\tborder-radius: 50%;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.input_box {\r\n\t\tposition: fixed;\r\n\t\tz-index: 10;\r\n\t\tleft: 0;\r\n\t\tbottom: 0;\r\n\t\twidth: 100%;\r\n\t\theight: 105.55rpx;\r\n\t\tbackground-color: white;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-evenly;\r\n\t\talign-items: center;\r\n\t\tbox-sizing: border-box;\r\n\t\tpadding: 10rpx 0;\r\n\t\tinput {\r\n\t\t\twidth: 60%;\r\n\t\t\theight: 80%;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tpadding-left: 20rpx;\r\n\t\t\toverflow: visible;\r\n\t\t\tposition: relative;\r\n\t\t}\r\n\t\tinput::before {\r\n\t\t\tcontent: ' ';\r\n\t\t\tposition: absolute;\r\n\t\t\ttop: 0;\r\n\t\t\tleft: 0;\r\n\t\t\twidth: 200%;\r\n\t\t\theight: 200%;\r\n\t\t\tborder: 1px solid black;\r\n\t\t\tborder-radius: 70rpx;\r\n\t\t\ttransform-origin: 0 0;\r\n\t\t\ttransform: scale(0.5);\r\n\t\t}\r\n\t\t.expression,\r\n\t\t.addImg {\r\n\t\t\twidth: 60rpx;\r\n\t\t\theight: 60rpx;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tpadding: 8rpx;\r\n\t\t\tborder-radius: 50%;\r\n\t\t}\r\n\t\t.send {\r\n\t\t\tbackground-color: #5d92e2;\r\n\t\t\tcolor: white;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tpadding: 10rpx 20rpx;\r\n\t\t\tborder-radius: 40rpx;\r\n\t\t}\r\n\t}\r\n\r\n\t// .choose{\r\n\t// \tposition: absolute;\r\n\t// \tbottom: 0;\r\n\t// \twidth: 100%;\r\n\t// \theight: 227px;\r\n\t// \tbackground-color: yellow;\r\n\t// }\r\n\r\n\t// 表情选择框\r\n\t// .send_user_expression{\r\n\t// \tbackground-color: yellow;\r\n\t// \twidth: 100%;\r\n\t// \theight:277px;\r\n\t// }\r\n\t// // 传递图片\r\n\t// .send_user_img{\r\n\t// \tbackground-color: green;\r\n\t// \twidth: 100%;\r\n\t// \theight:277px;\r\n\t// }\r\n\r\n\t// 0.5px的边框\r\n\t.border {\r\n\t\tposition: relative;\r\n\t}\r\n\t.border::before {\r\n\t\tcontent: ' ';\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\twidth: 200%;\r\n\t\theight: 200%;\r\n\t\tborder: 1px solid black;\r\n\t\tborder-radius: 50%;\r\n\t\ttransform-origin: 0 0;\r\n\t\ttransform: scale(0.5);\r\n\t}\r\n\timage {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n}\r\n</style>\n","import mod from \"-!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--10-oneOf-1-2!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-3!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-4!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--10-oneOf-1-5!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chartRoom.vue?vue&type=style&index=0&lang=less&\"; export default mod; export * from \"-!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--10-oneOf-1-2!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-3!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-4!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--10-oneOf-1-5!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uniapp/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chartRoom.vue?vue&type=style&index=0&lang=less&\""],"sourceRoot":""}