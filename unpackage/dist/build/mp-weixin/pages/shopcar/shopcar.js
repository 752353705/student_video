(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shopcar/shopcar"],{2206:function(t,e,r){"use strict";var o,a=function(){var t=this,e=t.$createElement;t._self._c},c=[];r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return c})),r.d(e,"a",(function(){return o}))},"2dd1":function(t,e,r){"use strict";var o=r("f852"),a=r.n(o);a.a},"4a99":function(t,e,r){"use strict";r.r(e);var o=r("f7a5"),a=r.n(o);for(var c in o)"default"!==c&&function(t){r.d(e,t,(function(){return o[t]}))}(c);e["default"]=a.a},"619e":function(t,e,r){"use strict";r.r(e);var o=r("2206"),a=r("4a99");for(var c in a)"default"!==c&&function(t){r.d(e,t,(function(){return a[t]}))}(c);r("2dd1");var d,i=r("f0c5"),n=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],d);e["default"]=n.exports},cdc1:function(t,e,r){"use strict";(function(t){r("21be");o(r("66fd"));var e=o(r("619e"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,r("543d")["createPage"])},f7a5:function(t,e,r){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a(r("65bf"));function a(t){return t&&t.__esModule?t:{default:t}}function c(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var d=function(){r.e("components/uni-number-box").then(function(){return resolve(r("921e"))}.bind(null,r)).catch(r.oe)},i={components:{uniNumberBox:d},data:function(){return c({hasLogin:!1,total:0,allChecked:!1,empty:!0,cartList:[],isMultiOrderModel:0,cartGoods:[],brandCartgoods:[],cartTotal:{goodsCount:0,goodsAmount:0,checkedGoodsCount:0,checkedGoodsAmount:0},isEditCart:!1,checkedAllStatus:!0,editCartList:[]},"hasLogin",!1)},onLoad:function(t){console.log("onLoad",t),this.loadData()},onShow:function(){t.getStorageSync("token")?(this.hasLogin=!0,this.getCartList()):this.hasLogin=!1},watch:{cartList:function(t){var e=0===t.length;this.empty!==e&&(this.empty=e)}},computed:{},methods:{getProductChecked:function(t){var e=this,r=null;return 1===e.isMultiOrderModel?e.brandCartgoods.forEach((function(e){var o=e.cartList;o.forEach((function(e){e.productId===t&&(r=e.checked?0:1)}))})):e.cartGoods.forEach((function(e){e.productId===t&&(r=e.checked?0:1)})),r},editCart:function(){var t=this;if(this.isEditCart)this.getCartList(),this.isEditCart=!this.isEditCart;else if(1===t.isMultiOrderModel){var e=t.brandCartgoods.map((function(t,e,r){var o=t.cartList.map((function(t,e,r){return t.checked=!1,t}));return t.cartList=o,t}));t.brandCartgoods=e,t.isEditCart=!t.isEditCart,t.checkedAllStatus=t.isCheckedAll(),t.cartTotal.checkedGoodsCount=t.getCheckedGoodsCount()}else{t.cartGoods.map((function(t,e,r){return t.checked=!1,t}));t.cartGoods=tmpCartList,t.isEditCart=!t.isEditCart,t.checkedAllStatus=t.isCheckedAll(),t.cartTotal.checkedGoodsCount=t.getCheckedGoodsCount()}},checkedItem:function(t){var e=t.currentTarget.dataset.productid,r=this,o=[];o.push(e);var a=r.getProductChecked(e);if(this.isEditCart)if(1===r.isMultiOrderModel){var c=this.brandCartgoods.map((function(t,r,o){var a=t.cartList.map((function(t,r,o){return t.productId===e&&(t.checked=!t.checked),t}));return t.cartList=a,t}));r.brandCartgoods=c,r.checkedAllStatus=r.isCheckedAll(),r.cartTotal.checkedGoodsCount=r.getCheckedGoodsCount()}else{var d=this.cartGoods.map((function(t,r,o){return t.productId===e&&(t.checked=!t.checked),t}));r.cartGoods=d,r.checkedAllStatus=r.isCheckedAll(),r.cartTotal.checkedGoodsCount=r.getCheckedGoodsCount()}else console.log("2"),this.api._post("cart/checked",{productIds:o,isChecked:a},(function(t){0===t.errno&&(console.log(t.data),1===t.data.isMultiOrderModel?(r.isMultiOrderModel=t.data.isMultiOrderModel,r.brandCartgoods=t.data.brandCartgoods,r.cartTotal=t.data.cartTotal):(r.isMultiOrderModel=t.data.isMultiOrderModel,r.cartGoods=t.data.cartList,r.cartTotal=t.data.cartTotal)),r.checkedAllStatus=r.isCheckedAll()}))},getCartList:function(){var t=this;this.api._get("cart/index",{},(function(e){0===e.errno&&(1===e.data.isMultiOrderModel?(t.isMultiOrderModel=e.data.isMultiOrderModel,t.brandCartgoods=e.data.brandCartgoods,t.cartTotal=e.data.cartTotal):(t.isMultiOrderModel=e.data.isMultiOrderModel,t.cartGoods=e.data.cartList,t.cartTotal=e.data.cartTotal),t.checkedAllStatus=t.isCheckedAll())}))},isCheckedAll:function(){var t=this;return 1===t.isMultiOrderModel?t.brandCartgoods.every((function(e,r,o){return!!t.isChildCheckedAll(e.cartList)})):t.cartGoods.every((function(t,e,r){return 1==t.checked}))},loadData:function(){var t=o.default["cartList"],e=t.map((function(t){return t.checked=!0,t}));this.cartList=e,this.calcTotal()},onImageLoad:function(t,e){this.$set(this[t][e],"loaded","loaded")},onImageError:function(t,e){this[t][e].image="/static/errorImage.jpg"},navToLogin:function(){t.navigateTo({url:"/pages/login/login"})},check:function(t,e){if("item"===t)this.cartList[e].checked=!this.cartList[e].checked;else{var r=!this.allChecked,o=this.cartList;o.forEach((function(t){t.checked=r})),this.allChecked=r}this.calcTotal(t)},numberChange:function(t){this.cartList[t.index].number=t.number,this.calcTotal()},deleteCartItem:function(e){var r=this.cartList,o=r[e];o.id;this.cartList.splice(e,1),this.calcTotal(),t.hideLoading()},clearCart:function(){var e=this;t.showModal({content:"清空购物车？",success:function(t){t.confirm&&(e.cartList=[])}})},calcTotal:function(){var t=this.cartList;if(0!==t.length){var e=0,r=!0;t.forEach((function(t){!0===t.checked?e+=t.price*t.number:!0===r&&(r=!1)})),this.allChecked=r,this.total=Number(e.toFixed(2))}else this.empty=!0},createOrder:function(){var e=this.cartList,r=[];e.forEach((function(t){t.checked&&r.push({attr_val:t.attr_val,number:t.number})})),console.log("创建订单进行跳转 goodsData =>",r),t.navigateTo({url:"/pages/order/creatOrder?data=".concat(JSON.stringify({goodsData:r}))})},isChildCheckedAll:function(t){return t.every((function(t,e,r){return 1==t.checked}))},checkedAll:function(){var t=this;if(this.isEditCart){var e=t.isCheckedAll();if(1===t.isMultiOrderModel){var r=this.brandCartgoods.map((function(t,r,o){var a=t.cartList.map((function(t,r,o){return t.checked=!e,t}));return t.cartList=a,t}));t.brandCartgoods=r,t.checkedAllStatus=t.isCheckedAll(),t.cartTotal.checkedGoodsCount=t.getCheckedGoodsCount()}else{var o=this.cartGoods.map((function(t,r,o){return t.checked=!e,t}));t.cartGoods=o,t.checkedAllStatus=t.isCheckedAll(),t.cartTotal.checkedGoodsCount=t.getCheckedGoodsCount()}}else{console.log("1");var a=[];if(1===t.isMultiOrderModel)t.brandCartgoods.forEach((function(t){t.cartList.forEach((function(t){a.push(t.productId)}))}));else t.cartGoods.map((function(t){return t.productId}));this.api._post("cart/checked",{productIds:a,isChecked:t.isCheckedAll()?0:1},(function(e){0===e.errno&&(console.log(e.data),1===e.data.isMultiOrderModel?(t.isMultiOrderModel=e.data.isMultiOrderModel,t.brandCartgoods=e.data.brandCartgoods,t.cartTotal=e.data.cartTotal):(t.isMultiOrderModel=e.data.isMultiOrderModel,t.cartGoods=e.data.cartList,t.cartTotal=e.data.cartTotal)),t.checkedAllStatus=t.isCheckedAll()}))}},getCheckedGoodsCount:function(){var t=this,e=0;return 1===t.isMultiOrderModel?t.brandCartgoods.forEach((function(t){t.cartList.forEach((function(t){!0===t.checked&&(e+=t.number)}))})):t.cartGoods.forEach((function(t){!0===t.checked&&(e+=t.number)})),console.log(e),e},cutNumber:function(t){var e=t.currentTarget.dataset.productid,r=this.getProductItem(e),o=r.number-1>1?r.number-1:1;r.number=o,this.setProductItem(r,e),this.updateCart(r.productId,r.goodsId,o,r.id)},addNumber:function(t){var e=t.currentTarget.dataset.productid,r=this.getProductItem(e),o=r.number+1;r.number=o,this.setProductItem(r,e),this.updateCart(r.productId,r.goodsId,o,r.id)},getProductItem:function(t){var e=this,r=null;return 1===e.isMultiOrderModel?e.brandCartgoods.forEach((function(e){var o=e.cartList;o.forEach((function(e){e.productId===t&&(r=e)}))})):e.cartGoods.forEach((function(e){e.productId===t&&(r=e)})),r},setProductItem:function(t,e){var r=this;if(1===r.isMultiOrderModel){var o=this.brandCartgoods.map((function(r,o,a){var c=r.cartList.map((function(r,o,a){return r.productId===e?t:r}));return r.cartList=c,r}));r.brandCartgoods=o,r.checkedAllStatus=r.isCheckedAll(),r.cartTotal.checkedGoodsCount=r.getCheckedGoodsCount()}else{var a=this.cartGoods.map((function(r,o,a){return r.productId===e?t:r}));r.cartGoods=a,r.checkedAllStatus=r.isCheckedAll(),r.cartTotal.checkedGoodsCount=r.getCheckedGoodsCount()}},updateCart:function(t,e,r,o){var a=this;this.api._post("cart/update",{productId:t,goodsId:e,number:r,id:o},(function(t){a.checkedAllStatus=a.isCheckedAll()}))},deleteCart:function(){var t=this;if(t.getCheckedGoodsCount()<=0)return wx.showModal({title:"错误信息",content:"请勾选需要删除的商品！",showCancel:!1}),!1;var e=[];1===t.isMultiOrderModel?t.brandCartgoods.forEach((function(t){t.cartList.forEach((function(t){1==t.checked&&e.push(t.productId)}))})):e=t.cartGoods.map((function(t){if(1==t.checked)return t.productId})),this.api._post("cart/delete",{productIds:e},(function(e){0===e.errno&&(1===e.data.isMultiOrderModel?(t.isMultiOrderModel=e.data.isMultiOrderModel,t.brandCartgoods=e.data.brandCartgoods,t.cartTotal=e.data.cartTotal):(t.isMultiOrderModel=e.data.isMultiOrderModel,t.cartGoods=e.data.cartList,t.cartTotal=e.data.cartTotal),t.checkedAllStatus=t.isCheckedAll())}))},checkoutOrder:function(){var t=this;if(t.getCheckedGoodsCount()<=0)return wx.showModal({title:"错误信息",content:"请勾选需要下单的商品！",showCancel:!1}),!1;try{wx.setStorageSync("cartId",0),wx.navigateTo({url:"/pages/order/creatOrder"})}catch(e){}}}};e.default=i}).call(this,r("543d")["default"])},f852:function(t,e,r){}},[["cdc1","common/runtime","common/vendor"]]]);