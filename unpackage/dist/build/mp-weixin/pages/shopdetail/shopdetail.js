(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shopdetail/shopdetail"],{2857:function(e,t,i){},"294a":function(e,t,i){"use strict";var o=i("2857"),n=i.n(o);n.a},"59f8":function(e,t,i){"use strict";i.r(t);var o=i("b47d"),n=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,(function(){return o[e]}))}(a);t["default"]=n.a},"74e5":function(e,t,i){"use strict";(function(e){i("21be");o(i("66fd"));var t=o(i("ed5b"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("543d")["createPage"])},b47d:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i("282a"),n={components:{},data:function(){return{id:23851,goods:{},groupon:[],grouponLink:{},attribute:[],issueList:[],comment:[],brand:{},specificationList:[],productList:[],relatedGoods:[],cartGoodsCount:0,userHasCollect:0,number:1,checkedSpecText:"规格数量选择",tmpSpecText:"请选择规格数量",checkedSpecPrice:0,openAttr:!1,openShare:!1,noCollectImage:"/static/images/icon_like.png",hasCollectImage:"/static/images/icon_like_checked.png",collectImage:"/static/images/icon_like.png",shareImage:"",isGroupon:!1,soldout:!1,canWrite:!1}},onLoad:function(e){console.log("shopdetail",e),this.getGoodsInfo(),e.id&&(this.id=parseInt(e.id),this.getGoodsInfo()),e.grouponId&&(this.isGroupon=!0,this.getGrouponInfo(e.grouponId));var t=this;wx.getSetting({success:function(e){console.log(e),e.authSetting["scope.writePhotosAlbum"]?t.canWrite=!0:wx.authorize({scope:"scope.writePhotosAlbum",success:function(){t.canWrite=!0},fail:function(e){t.canWrite=!1}})}})},onShow:function(){var e=this;this.api._get("cart/goodscount",{id:e.id},(function(t){e.cartGoodsCount=t.data}))},onShareAppMessage:function(){var e=this,t=wx.getStorageSync("userInfo"),i=1;return t&&(i=t.userId),{title:e.goods.name,desc:"好货分享",path:"/pages/index/index?goodId="+this.id+"&shareUserId="+i}},methods:{shareFriendOrCircle:function(){if(!1!==this.openShare)return!1;this.openShare=!this.openShare},addFast:function(){var t=this;if(0==this.openAttr)this.openAttr=!this.openAttr;else{if(!this.isCheckedAllSpec())return wx.showToast({image:"/static/images/icon_error.png",title:"请选择完整规格"}),!1;var i=this.getCheckedProductItem(this.getCheckedSpecKey());if(!i||i.length<=0)return wx.showToast({image:"/static/images/icon_error.png",title:"没有库存"}),!1;var o=i[0];if(o.number<=0)return wx.showToast({image:"/static/images/icon_error.png",title:"没有库存"}),!1;var n=this.getCheckedGrouponValue();this.api._post("cart/fastadd",{goodsId:this.goods.id,number:this.number,productId:o.id},(function(i){if(0==i.errno)try{wx.setStorageSync("cartId",i.data),wx.setStorageSync("grouponRulesId",n.id),wx.setStorageSync("grouponLinkId",t.grouponLink.id),e.navigateTo({url:"/pages/order/creatOrder"})}catch(o){}else wx.showToast({image:"/static/images/icon_error.png",title:i.errmsg,mask:!0})}))}},addCollectOrNot:function(){var e=this;this.api._post("collect/addordelete",{type:0,valueId:this.id},(function(t){var i=t;0==i.errno?"add"==i.data.type?e.collectImage=e.hasCollectImage:e.collectImage=e.noCollectImage:wx.showToast({image:"/static/images/icon_error.png",title:i.errmsg,mask:!0})}))},getCheckedGrouponValue:function(){for(var e={},t=this.groupon,i=0;i<t.length;i++)t[i].checked&&(e=t[i]);return e},getGoodsInfo:function(){var e=this;this.api._get("goods/detail",{id:e.id},(function(t){if(0===t.errno){var i=t.data.specificationList;if(1==i.length&&1==i[0].valueList.length){i[0].valueList[0].checked=!0;var n=t.data.productList[0].price,a=t.data.info.retailPrice;n!=a&&console.error("商品数量价格和货品不一致"),e.checkedSpecText=i[0].valueList[0].value,e.tmpSpecText="已选择："+i[0].valueList[0].value}if(e.goods=t.data.info,e.attribute=t.data.attribute,e.issueList=t.data.issue,e.comment=t.data.comment,e.brand=t.data.brand,e.specificationList=t.data.specificationList,e.productList=t.data.productList,e.userHasCollect=t.data.userHasCollect,e.shareImage=t.data.shareImage,e.checkedSpecPrice=t.data.info.retailPrice,e.groupon=t.data.groupon,e.isGroupon){for(var r=e.groupon,c=0;c<r.length;c++)r[c].id!=e.grouponLink.rulesId&&r.splice(c,1);r[0].checked=!0,e.groupon=r}1==t.data.userHasCollect?e.collectImage=e.hasCollectImage:e.collectImage=e.noCollectImage,o.wxParse("goodsDetail","html",t.data.info.detail,e)}}))},getGrouponInfo:function(e){var t=this;util.request(api.GroupOnJoin,{grouponId:e}).then((function(e){0===e.errno&&(t.setData({grouponLink:e.data.groupon,id:e.data.goods.id}),t.getGoodsInfo())}))},switchAttrPop:function(){0==this.openAttr&&(this.openAttr=!this.openAttr)},closeAttr:function(){this.openAttr=!1},clickSkuValue:function(e){for(var t=this,i=e.currentTarget.dataset.name,o=e.currentTarget.dataset.valueId,n=this.specificationList,a=0;a<n.length;a++)if(n[a].name===i)for(var r=0;r<n[a].valueList.length;r++)n[a].valueList[r].id==o?n[a].valueList[r].checked?n[a].valueList[r].checked=!1:(n[a].valueList[r].checked=!0,t.setSpecificationUrl(n[a].valueList[r].picUrl)):n[a].valueList[r].checked=!1;this.specificationList=n,this.changeSpecInfo()},getCheckedSpecValue:function(){for(var e=[],t=this.specificationList,i=0;i<t.length;i++){for(var o={name:t[i].name,valueId:0,valueText:""},n=0;n<t[i].valueList.length;n++)t[i].valueList[n].checked&&(o.valueId=t[i].valueList[n].id,o.valueText=t[i].valueList[n].value);e.push(o)}return e},setSpecificationUrl:function(e){e&&e.length>1&&-1==e.indexOf("lazyload.png")&&(this.checkSpecificationUrl=e)},changeSpecInfo:function(){var e=this.getCheckedSpecValue(),t=e.filter((function(e){return 0!=e.valueId})).map((function(e){return e.valueText}));if(t.length>0?this.tmpSpecText=t.join("　"):this.tmpSpecText="请选择规格数量",this.isCheckedAllSpec()){this.checkedSpecText=this.tmpSpecText;var i=this.getCheckedProductItem(this.getCheckedSpecKey());if(!i||i.length<=0)return this.soldout=!0,void console.error("规格所对应货品不存在");var o=i[0];o.number>0?(this.checkedSpecPrice=o.price,this.soldout=!1):(this.checkedSpecPrice=this.goods.retailPrice,this.soldout=!0)}else this.checkedSpecText="规格数量选择",this.checkedSpecPrice=this.goods.retailPrice,this.soldout=!1},isCheckedAllSpec:function(){return!this.getCheckedSpecValue().some((function(e){if(0==e.valueId)return!0}))},getCheckedSpecKey:function(){var e=this.getCheckedSpecValue().map((function(e){return e.valueText}));return e},getCheckedProductItem:function(e){return this.productList.filter((function(t){return console.log(e.toString()+"--"+t.specifications.toString()),t.specifications.toString()==e.toString()}))},addNumber:function(){this.number=this.number+1},addToCart:function(){var e=this;if(0==this.openAttr)this.openAttr=!this.openAttr;else{if(!this.isCheckedAllSpec())return wx.showToast({image:"/static/images/icon_error.png",title:"请选择完整规格"}),!1;var t=this.getCheckedProductItem(this.getCheckedSpecKey());if(!t||t.length<=0)return wx.showToast({image:"/static/images/icon_error.png",title:"没有库存"}),!1;var i=t[0];if(i.number<=0)return wx.showToast({image:"/static/images/icon_error.png",title:"没有库存"}),!1;this.api._post("cart/add",{goodsId:this.goods.id,number:this.number,productId:i.id},(function(t){var i=t;0==i.errno?(wx.showToast({title:"添加成功"}),e.openAttr=!e.openAttr,e.cartGoodsCount=i.data,1==e.userHasCollect?e.collectImage=e.hasCollectImage:e.collectImage=e.noCollectImage):wx.showToast({image:"/static/images/icon_error.png",title:i.errmsg,mask:!0})}))}},cutNumber:function(){this.number=this.number-1>1?this.number-1:1},openCartPage:function(){e.navigateTo({url:"/pages/shopcar/shopcar"})},closeShare:function(){this.openShare=!1}}};t.default=n}).call(this,i("543d")["default"])},ed5b:function(e,t,i){"use strict";i.r(t);var o=i("ef1b"),n=i("59f8");for(var a in n)"default"!==a&&function(e){i.d(t,e,(function(){return n[e]}))}(a);i("294a");var r,c=i("f0c5"),s=Object(c["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],r);t["default"]=s.exports},ef1b:function(e,t,i){"use strict";var o,n=function(){var e=this,t=e.$createElement;e._self._c},a=[];i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){return o}))}},[["74e5","common/runtime","common/vendor"]]]);